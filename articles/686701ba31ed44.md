---
title: "React18ã®æ–°æ©Ÿèƒ½ï¼ˆTransitionï¼‰ã‚’ä½¿ç”¨ã—ãŸã‚¹ãƒ ãƒ¼ã‚ºãªãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³åŠ¹æœã‚’ç¢ºèª"
emoji: "ğŸ›¸"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["React", "javascript"]
published: true
---

# ã¯ã˜ã‚ã«

ä»Šå›ã¯ React18 ã®æ–°æ©Ÿèƒ½`Transition`ã«ã¤ã„ã¦ç¢ºèªã—ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚
Automatic Batchig ã«ã¤ã„ã¦ã¯ã“ã¡ã‚‰ã®è¨˜äº‹ã‚’ã”è¦§ãã ã•ã„ã€‚
https://zenn.dev/rh820/articles/3403e2b1533f6c

### å‹•ä½œç¢ºèªç”¨ãƒªãƒã‚¸ãƒˆãƒª

https://github.com/dahoho/react-18-demo

# Transition ã¨ã¯ï¼Ÿ

> ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³ï¼ˆtransition; æ®µéšçš„æ¨ç§»ï¼‰ã¨ã¯ React ã«ãŠã‘ã‚‹æ–°ãŸãªæ¦‚å¿µã§ã‚ã‚Šã€ç·Šæ€¥æ€§ã®é«˜ã„æ›´æ–° (urgent update) ã¨é«˜ããªã„æ›´æ–° (non-urgent update) ã‚’åŒºåˆ¥ã™ã‚‹ãŸã‚ã®ã‚‚ã®ã§ã™ã€‚
> ç·Šæ€¥æ€§ã®é«˜ã„æ›´æ–°ã¨ã¯ã‚¿ã‚¤ãƒ—ã€ã‚¯ãƒªãƒƒã‚¯ã€ãƒ—ãƒ¬ã‚¹ã¨ã„ã£ãŸãƒ¦ãƒ¼ã‚¶æ“ä½œã‚’ç›´æ¥åæ˜ ã™ã‚‹ã‚‚ã®ã§ã™ã€‚
> ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³ã«ã‚ˆã‚‹æ›´æ–°ã¯ UI ã‚’ã‚ã‚‹ç”»é¢ã‹ã‚‰åˆ¥ã®ç”»é¢ã«æ®µéšçš„ã«é·ç§»ã•ã›ã‚‹ã‚‚ã®ã§ã™ã€‚
> ã‚¿ã‚¤ãƒ—ã€ã‚¯ãƒªãƒƒã‚¯ã€ãƒ—ãƒ¬ã‚¹ã®ã‚ˆã†ãªç·Šæ€¥æ€§ã®é«˜ã„æ›´æ–°ã¯ã€ç‰©ç†çš„ãªç‰©ä½“ã®æŒ™å‹•ã«é–¢ã™ã‚‹æˆ‘ã€…ã®ç›´è¦³ã«åã—ãªã„ã‚ˆã†ã€å³åº§ã«åå¿œã™ã‚‹å¿…è¦ãŒã‚ã‚Šã€ãã†ã§ãªã„ã¨ã€ŒãŠã‹ã—ã„ã€ã¨èªè­˜ã•ã‚Œã¦ã—ã¾ã„ã¾ã™ã€‚ä¸€æ–¹ã§ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³å†…ã§ã¯ã€ãƒ¦ãƒ¼ã‚¶ã¯ç”»é¢ä¸Šã§ã‚ã‚‰ã‚†ã‚‹ä¸­é–“ã®å€¤ãŒè¦‹ãˆã‚‹ã“ã¨ã‚’æœŸå¾…ã—ã¦ã„ã¾ã›ã‚“ã€‚

å¼•ç”¨å…ƒï¼š[https://ja.react.dev/blog/2022/03/29/react-v18#new-feature-transitions](https://ja.react.dev/blog/2022/03/29/react-v18#new-feature-transitions)

ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³ã¯å„ªå…ˆåº¦ãŒé«˜ã„å¤‰æ›´ã¨ä½ã„å¤‰æ›´ã‚’åŒºåˆ¥ã—ã¦ã€å„ªå…ˆåº¦ã®é«˜ã„å¤‰æ›´ã‚’å„ªå…ˆçš„ã«è¡Œã†æ©Ÿèƒ½ã§ã™ã€‚
ä¾‹ãˆã°ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã¨ãã«ã€ä»¥ä¸‹äºŒã¤ã®å¤‰æ›´ã‚’è¡Œã†å ´åˆã‚’è€ƒãˆã¦ã¿ã¾ã™ã€‚

- ãƒœã‚¿ãƒ³ã®è‰²ã‚’å¤‰æ›´ã™ã‚‹ï¼ˆé«˜å„ªå…ˆåº¦ï¼‰
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã™ã‚‹ï¼ˆä½å„ªå…ˆåº¦ï¼‰

ã“ã®å ´åˆã€ãƒœã‚¿ãƒ³ã®è‰²ã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ“ä½œã‚’ç›´æ¥åæ˜ ã™ã‚‹éƒ¨åˆ†ãªã®ã§ã€å„ªå…ˆåº¦ã¯é«˜ã„ã¨è€ƒãˆã¾ã™ã€‚
ä¸€æ–¹ã§ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã™ã‚‹å¤‰æ›´ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ“ä½œã«ç›´æ¥é–¢ã‚ã‚‹éƒ¨åˆ†ã§ã¯ãªã„ãŸã‚ã€å„ªå…ˆåº¦ã¯ä½ã„ã¨ã—ã¾ã™ã€‚
ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€é«˜å„ªå…ˆåº¦ã®å¤‰æ›´ã§ã‚ã‚‹ã€Œãƒœã‚¿ãƒ³ã®è‰²ã‚’å¤‰æ›´ã™ã‚‹ã€å¤‰æ›´ãŒã€ä½å„ªå…ˆåº¦ã®å¤‰æ›´ã§ã‚ã‚‹ã€Œãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã™ã‚‹ã€å¤‰æ›´ã‚ˆã‚Šã‚‚å„ªå…ˆçš„ã«å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚

## Transition ã‚’ä½¿ç”¨ã—ãŸãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚³ã‚¹ãƒˆã®é«˜ã„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®æ”¹å–„ã¨å‹•ä½œç¢ºèª

10000 ä»¶ã®ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã—ã¦ã„ã‚‹ã€ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚³ã‚¹ãƒˆãŒé«˜ã„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆã—ã¦å‹•ä½œç¢ºèªã‚’ã—ã¦ã¿ã¾ã™ã€‚

:::message
ã‚¹ãƒšãƒƒã‚¯ã®é«˜ã„ PC ã§ã®å‹•ä½œã¯å•é¡Œãªã„å ´åˆãŒã‚ã‚Šã¾ã™ã®ã§ã€ä»Šå›ã¯ã‚¹ãƒšãƒƒã‚¯ã®ä½ã„ PC ã‚’æƒ³å®šã—ã¦ç’°å¢ƒã§ç¢ºèªã—ã¦ã¿ã¾ã™ã€‚
Google Chrome ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ãƒ„ãƒ¼ãƒ«ã® `Performance > CPU` ã®æ€§èƒ½ã‚‚ `6x Slowdown` ã«è½ã¨ã—ã¾ã™ã€‚
ã‚¿ãƒ–ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ãŒåˆ†ã‹ã‚‹ã‚ˆã†ã«ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ãƒ­ã‚°ã‚’å‡ºåŠ›ã—ã¦ã„ã¾ã™ã€‚
:::
![](https://storage.googleapis.com/zenn-user-upload/aecff4e5cd89-20230918.png)

```tsx:TransitionTest.tsx
import { useState } from "react";
import MemberButton from "./MemberButton";

type Task = {
  id: number;
  title: string;
  name: string;
  description: string;
};

const member = {
  a: "A",
  b: "B",
  c: "C",
};

const createTaskArray = (): Task[] => {
  return Array(10000)
    .fill("")
    .map((_, index) => {
      const addIndex = index + 1;
      return {
        id: addIndex,
        title: `title${addIndex}`,
        description: `description${addIndex}`,
        name:
          addIndex % 3 === 0
            ? member.a
            : addIndex % 2 === 0
            ? member.b
            : member.c,
      };
    });
};

const tasksArray = createTaskArray();

const filteringMember = (member: string) => {
  if (member === "") return tasksArray;
  return tasksArray.filter((task) => task.name === member);
};

const TransitionTest = () => {
  const [selectMember, setSelectMember] = useState<string>("");
  const [tasks, setTasks] = useState<Task[]>(tasksArray);

  const clickMember = (member: string) => {
    console.log("ã‚¯ãƒªãƒƒã‚¯ã•ã‚Œã¾ã—ãŸï¼ï¼");
    setSelectMember(member);

    setTasks(filteringMember(member));
  };

  return (
    <>
      <p className="text-3xl text-center mt-20">TransitionTest</p>
      <div className="flex justify-center gap-5 mt-8">
        <MemberButton
          onClick={clickMember}
          isActive={selectMember === member.a}
        >
          {member.a}
        </MemberButton>
        <MemberButton
          onClick={clickMember}
          isActive={selectMember === member.b}
        >
          {member.b}
        </MemberButton>
        <MemberButton
          onClick={clickMember}
          isActive={selectMember === member.c}
        >
          {member.c}
        </MemberButton>
      </div>
      <div className="text-center mt-8">
        <button
          className="bg-gray-600 text-white py-2 px-4 m-auto inline-block"
          onClick={() => clickMember("")}
        >
          ãƒªã‚»ãƒƒãƒˆ
        </button>
      </div>

      <ul className={`grid gap-4 mt-8`}>
        {tasks?.map((task) => (
          <li key={task.id} className="bg-gray-300 w-80 m-auto p-3">
            <p>ã‚¿ã‚¤ãƒˆãƒ«: {task.title}</p>
            <p>èª¬æ˜: {task.description}</p>
            <p>åå‰: {task.name}</p>
          </li>
        ))}
      </ul>
    </>
  );
};

export default TransitionTest;
```

### æ”¹å–„å‰

ã‚¿ãƒ–ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãŒå‡ºåŠ›ã•ã‚Œã¦ã„ã¾ã™ãŒã€èƒŒæ™¯è‰²ãŒå¤‰ã‚ã‚‹ã¾ã§ã«æ™‚é–“ãŒã‹ã‹ã£ã¦ã„ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚
æ“ä½œã—ã¦ã„ã‚‹å´ã‹ã‚‰ã—ãŸã‚‰ä½¿ã„ã¥ã‚‰ã„ã§ã™ã­ãƒ»ãƒ»
![](https://storage.googleapis.com/zenn-user-upload/8bdcc6c79eda-20230918.gif)

### useTransition ã‚’ä½¿ç”¨ã—ãŸæ”¹å–„

useTransition ã‚’ import ã—ã¦ã€é…åˆ—ã®åˆ†å‰²ä»£å…¥ã§`isPending`ã¨`startTransition`ã‚’å®šç¾©ã—ã¾ã™ã€‚
å„ªå…ˆåº¦ãŒä½ãã€Transition ã‚’ã•ã›ãŸã„ set é–¢æ•°ã‚’`startTransition`ã®ä¸­ã«å…¥ã‚Œã¾ã™ã€‚
ã¾ãŸ`isPending`ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ `startTransision` å†…ã§ set é–¢æ•°ã® state ãŒæ›´æ–°ä¸­ã‹ã©ã†ã‹ã®ãƒ•ãƒ©ã‚°ã‚’ boolean ã¨ã—ã¦è¿”ã—ã¦ãã‚Œã¾ã™ã€‚
ã“ã‚Œã‚’åˆ©ç”¨ã—ã¦ã€æ›´æ–°ä¸­ã¯ã€Œæ›´æ–°ä¸­ã§ã™ ğŸ˜Œã€ã¨ã„ã†ãƒ†ã‚­ã‚¹ãƒˆã‚’è¡¨ç¤ºã•ã›ã¦ã¿ã‚‹ã“ã¨ã¨ã—ã¾ã™ã€‚
https://react.dev/reference/react/useTransition

```diff:TransitionTest.tsx
+ import { useState, useTransition } from "react";
import MemberButton from "./MemberButton";

type Task = {
  id: number;
  title: string;
  name: string;
  description: string;
};

const member = {
  a: "A",
  b: "B",
  c: "C",
};

const createTaskArray = (): Task[] => {
  return Array(10000)
    .fill("")
    .map((_, index) => {
      const addIndex = index + 1;
      return {
        id: addIndex,
        title: `title${addIndex}`,
        description: `description${addIndex}`,
        name:
          addIndex % 3 === 0
            ? member.a
            : addIndex % 2 === 0
            ? member.b
            : member.c,
      };
    });
};

const tasksArray = createTaskArray();

const filteringMember = (member: string) => {
  if (member === "") return tasksArray;
  return tasksArray.filter((task) => task.name === member);
};

const TransitionTest = () => {
+  const [isPending, startTransition] = useTransition();
  const [selectMember, setSelectMember] = useState<string>("");
  const [tasks, setTasks] = useState<Task[]>(tasksArray);

  const clickMember = (member: string) => {
    console.log("ã‚¯ãƒªãƒƒã‚¯ã•ã‚Œã¾ã—ãŸï¼ï¼");
    setSelectMember(member);
+    startTransition(() => {
+      setTasks(filteringMember(member));
+    });
  };

  return (
    <>
      <p className="text-3xl text-center mt-20">TransitionTest</p>
      <div className="flex justify-center gap-5 mt-8">
        <MemberButton
          onClick={clickMember}
          isActive={selectMember === member.a}
        >
          {member.a}
        </MemberButton>
        <MemberButton
          onClick={clickMember}
          isActive={selectMember === member.b}
        >
          {member.b}
        </MemberButton>
        <MemberButton
          onClick={clickMember}
          isActive={selectMember === member.c}
        >
          {member.c}
        </MemberButton>
      </div>
      <div className="text-center mt-8">
        <button
          className="bg-gray-600 text-white py-2 px-4 m-auto inline-block"
          onClick={() => clickMember("")}
        >
          ãƒªã‚»ãƒƒãƒˆ
        </button>
      </div>
+      {isPending ? (
+        <p className="text-center mt-12 text-xl">æ›´æ–°ä¸­ã§ã™ğŸ˜Œ</p>
+      ) : (
+        <ul className={`grid gap-4 mt-8`}>
+          {tasks?.map((task) => (
+            <li key={task.id} className="bg-gray-300 w-80 m-auto p-3">
+              <p>ã‚¿ã‚¤ãƒˆãƒ«: {task.title}</p>
+              <p>èª¬æ˜: {task.description}</p>
+              <p>åå‰: {task.name}</p>
+            </li>
+          ))}
+        </ul>
+      )}
    </>
  );
};

export default TransitionTest;

```

### æ”¹å–„å¾Œ

ã‚¿ãƒ–ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‹ã‚‰ã€ã‚¿ã‚°ã®èƒŒæ™¯è‰²ãŒå¤‰ã‚ã‚‹ã¾ã§ã®æ™‚é–“ãŒçŸ­ããªã‚Šã€ã¨ã¦ã‚‚ä½¿ã„ã‚„ã™ããªã‚Šã¾ã—ãŸï¼
ã¾ãŸå„ªå…ˆåº¦ã®ä½ã„ã€çµã‚Šè¾¼ã¿çµæœå´ã®è¡¨ç¤ºã¯å°‘ã—é…ã‚Œã¦ã„ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/0a10d0b43d85-20230918.gif)

# ã¾ã¨ã‚

ä»Šå›ã¯ React18 ã®æ–°æ©Ÿèƒ½`Transition`ã®å‹•ä½œç¢ºèªã‚’ã—ã¦ã¿ã¾ã—ãŸã€‚
å®Ÿéš›ã«ã‚³ãƒ¼ãƒ‰ã‚’å‹•ã‹ã—ã¦ã¿ã‚‹ã“ã¨ã§ã€å„ªå…ˆåº¦ã®é«˜ã„å¤‰æ›´ã¨ä½ã„å¤‰æ›´ã‚’åŒºåˆ¥ã—ã¦ã€å„ªå…ˆåº¦ã®é«˜ã„å¤‰æ›´ã‚’å„ªå…ˆçš„ã«è¡Œã†ã“ã¨ãŒã§ãã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã—ãŸã€‚
ä»Šå¾Œã¯ Suspense ãªã©ã®æ©Ÿèƒ½ã«ã¤ã„ã¦ã‚‚ç¢ºèªã—ã¦ã„ããŸã„ã§ã™ã€‚

# å‚è€ƒæ–‡çŒ®

https://ja.legacy.reactjs.org/blog/2022/03/29/react-v18.html
https://www.udemy.com/course/react_v18/
