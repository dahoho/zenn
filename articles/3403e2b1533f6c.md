---
title: "フロントエンドテスト【単体テスト】"
emoji: "🧪"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["typescript", "javascript"]
published: false
---

フロントエンドエンジニアとして働きはじめて約２ヶ月経ちましたが、一度もテストを書いたことがなかったため基本的なことですが、理解を深めるためにもまとめてみることにしました！

# テストを書く目的

まずそもそもテストを書く目的は何があるのでしょうか？
なんとなくバグを少なくするために書くべきなのだろうなというぐらいしか思いつきませんでした。
ただ調べてみると、他にもテストを書くべき理由がありました。

- 信頼のため

- 健全なコードの維持

- 品質に自信を持つため

- コードレビューの時間短縮

# 前提条件

テスティングフレームワークは「Jest」を使用します。
環境構築に関する説明は省きます。

# 単体テスト

テストは Jest が提供している test 関数を使用します。

## 構成

- 第一引数
  テスト内容を表すタイトル
- 第二引数
  アサーション（検証値が期待値通りである）を記述
  `expect(検証値).toBe(期待値)`
  `toBe(期待値)`の部分をマッチャーはマッチャーと呼ばています。
  マッチャーは Jest から標準でいろいろな種類が用意されている。

```ts:index.test.ts
test(テストタイトル,テスト関数);

test("1 + 1 は 2",() => {
  expect(検証値).toBe(期待値);
})
```

## テストグループ

関連するいくつかのテストをグルーピングしたい場合に describe 関数が使用してまとめることができます。

```ts:index.test.ts
describe(func,()=>{
test("1 + 1 は 2",()=>{
expect(add(1,1)).toBe(2);
});
test("1 + 2" は 3,()=>{
expect(add(1,2)).toBe(3);
});
})
```

## 例外をスローする実装

### 例外のスローを検証するアサーション

0〜100 の間で入力などの条件は TypeScript だけでは厳しい。

```ts:index.test.tsx
export function add(a: number, b: number) {
  if(a < 0 || a > 100) {
    throw new Error("0〜100の間で入力してください。");
  }
  if(b < 0 || b > 100) {
    throw new Error("0〜100の間で入力してください。");
  }
  return a + b;
}
```

```ts:index.test.ts
// toThrow マッチャーに引数を与えることで、スローされた例外の内訳を詳細に検証することができる。
test("引数が0〜100の範囲外だった場合、例外をスローする",() => {
  expect(()=> add(-10,50)).toThrow("0〜100の間で入力してください。");
})
```

### instanceof 演算子による詳細な検証

```ts:index.tsx
export class HttpError extends Error {}
export class RangeError extends Error {}

if(err instanceof HttpError) {
  // 例外がHttpErrorインスタンスだった場合
}
if(err instanceof RangeError) {
  // 例外がRangeErrorインスタンスだった場合
}

function checkRange(value: number) {
  if(value < 0 || value > 10) {
    throw new RangeError("入力値は0〜100の間で入力してください");
  }
}

export function add(a: number,b: number) {
  checkRange(a);
  checkRange(b);
  const sum = a + b;
  if(sum > 100) {
    return 100;
  }
  return a + b;
}
```

```ts:index.test.ts
// スローされる例外はRangeErrorなので失敗する
expect(()=> add(110,-10)).toThrow(HttpError);
// スローされる例外はRangeErrorなので成功する
expect(()=> add(110,-10)).toThrow(RangeError);
// スローされる例外はErrorの派生クラスなので成功する
expect(()=> add(110,-10)).toThrow(Error);
```

※toThrow 以外にも用途別のマッチャーがさまざま提供されているようなので、都度調べて使いこなせるようになりたいです。

# まとめ
